var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.data=(function(){var b="https://whosonfirst.mapzen.com/data/";var a={endpoint:function(c){if(c){mapzen.whosonfirst.log.info("set data endpoint to "+c);b=c}return b},id2abspath:function(e){var d=a.id2relpath(e);var c=a.endpoint()+d;return c},id2relpath:function(d){parent=a.id2parent(d);fname=a.id2fname(d);var c=parent+"/"+fname;return c},id2parent:function(d){str_id=new String(d);tmp=new Array();while(str_id.length){var c=str_id.substr(0,3);tmp.push(c);str_id=str_id.substr(3)}parent=tmp.join("/");return parent},id2fname:function(c){return c+".geojson"}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.log=(function(){var b=[];var a={show:function(){a.toggle(true)},hide:function(){a.toggle(false)},toggle:function(d){var f=document.getElementById("wof-log-container");if(!f){return false}var e=(d)?"display:block":"display:none";f.style=e},debug:function(c){a.log(c,"debug")},info:function(c){a.log(c,"info")},warning:function(c){a.log(c,"warning")},error:function(c){a.log(c,"error")},log:function(f,c){var e=new Date();b.push([c,f,e]);var d=a._render(f,c,e);a._attach(d)},_render:function(f,l,d){var g=mapzen.whosonfirst.php.htmlspecialchars(f);var e=mapzen.whosonfirst.php.htmlspecialchars(l);var k=document.createElement("li");k.setAttribute("class","wof-log-item wof-log-"+e);var j=document.createTextNode(" "+g);var i=document.createElement("span");i.setAttribute("class","wof-log-body");i.appendChild(j);var h=d.toISOString();h=mapzen.whosonfirst.php.htmlspecialchars(h);h=document.createTextNode(h+" "+l);var c=document.createElement("code");c.setAttribute("class","wof-log-ts");c.appendChild(h);k.appendChild(c);k.appendChild(i);return k},_attach:function(c){var d=document.getElementById("wof-log");if(!d){console.log("faile to locate #wof-log container");return false}d.insertBefore(c,d.childNodes[0]);return true}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.enmapify=(function(){var a={render_id:function(f,e,d){var b=a;if(!e){mapzen.whosonfirst.log.error("failed to enmapify because missing WOF ID");return false}if(!d){d=function(g){a.render_feature(f,g)}}var c=mapzen.whosonfirst.data.id2abspath(e);mapzen.whosonfirst.net.fetch(c,d)},render_feature_outline:function(c,b){mapzen.whosonfirst.leaflet.fit_map(c,b);mapzen.whosonfirst.leaflet.draw_poly(c,b,mapzen.whosonfirst.leaflet.styles.parent_polygon())},render_feature:function(c,j){mapzen.whosonfirst.leaflet.fit_map(c,j);var g=j.properties;var b=g["wof:id"];var f=g["wof:parent_id"];var h=mapzen.whosonfirst.data.id2abspath(b);var d=mapzen.whosonfirst.data.id2abspath(f);var e=function(l){mapzen.whosonfirst.leaflet.fit_map(c,l);l.properties["lflt:label_text"]=l.properties["wof:name"];mapzen.whosonfirst.leaflet.draw_poly(c,l,mapzen.whosonfirst.leaflet.styles.parent_polygon());var k=function(){mapzen.whosonfirst.log.error("failed to render "+d);i()};mapzen.whosonfirst.net.fetch(h,i,k)};var i=function(n){var p=n.properties;var x=n.geometry;var s=p["geom:latitude"];var r=p["geom:longitude"];var o="math centroid (shapely) is ";o+=s+", "+r;var w={type:"Feature",geometry:{type:"Point",coordinates:[r,s]},properties:{"lflt:label_text":o}};if(x.type=="Point"){var D=p["wof:name"];var o=D;o+=", whose centroid is ";o+=s+", "+r;w.properties["lflt:label_text"]=o;var B=mapzen.whosonfirst.leaflet.styles.geom_centroid();var k=mapzen.whosonfirst.leaflet.handlers.point(B);mapzen.whosonfirst.leaflet.draw_point(c,w,B,k);return}var l=true;mapzen.whosonfirst.leaflet.fit_map(c,n,l);n.properties["lflt:label_text"]="";mapzen.whosonfirst.leaflet.draw_bbox(c,n,mapzen.whosonfirst.leaflet.styles.bbox());n.properties["lflt:label_text"]=n.properties["wof:name"];mapzen.whosonfirst.leaflet.draw_poly(c,n,mapzen.whosonfirst.leaflet.styles.consensus_polygon());var C=function(){if(!H){var I=p["geom:latitude"];var J=p["geom:longitude"];var G="math centroid (shapely) is ";G+=I+", "+J;var H={type:"Feature",geometry:{type:"Point",coordinates:[J,I]},properties:{"lflt:label_text":G}}}var F=mapzen.whosonfirst.leaflet.styles.math_centroid();var E=mapzen.whosonfirst.leaflet.handlers.point(F);mapzen.whosonfirst.leaflet.draw_point(c,H,F,E);if((p["lbl:latitude"])&&(p["lbl:longitude"])){var I=p["lbl:latitude"];var J=p["lbl:longitude"];var K=p["src:lbl:centroid"]||p["src:centroid_lbl"]||"UNKNOWN";var G="label centroid (";G+=K;G+=") is ";G+=I+", "+J;var H={type:"Feature",geometry:{type:"Point",coordinates:[J,I]},properties:{"lflt:label_text":G}};var F=mapzen.whosonfirst.leaflet.styles.label_centroid();var E=mapzen.whosonfirst.leaflet.handlers.point(F);mapzen.whosonfirst.leaflet.draw_point(c,H,F,E)}};var u=p["wof:breaches"];var t=u.length;if(!t){C()}else{for(var A=0;A<t;A++){var m=u[A];var y=mapzen.whosonfirst.data.id2abspath(m);var z=mapzen.whosonfirst.leaflet.styles.breach_polygon();var v=function(J){var F=n.properties;var G=F["wof:name"];var E=J.properties;var I=E["wof:name"];var H=I+" breaches "+G;p["lflt:label_text"]=H;J.properties=p;mapzen.whosonfirst.leaflet.draw_poly(c,J,z);if(A==t){C()}};mapzen.whosonfirst.net.fetch(y,v)}}};if((!f)||(f==-1)){mapzen.whosonfirst.net.fetch(h,i)}else{mapzen.whosonfirst.net.fetch(d,e,function(){i()})}},enmapify_feature:function(b,c){}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.feedback=(function(){var b=undefined;var d=5000;var c=10000;var a={alert:function(e){this.append(e,"alert")},debug:function(e){this.append(e,"debug")},info:function(e){this.append(e,"info")},warning:function(e){this.append(e,"warning")},error:function(e){this.append(e,"warning")},persist:function(e){this.append(e,"persist")},append:function(g,m){mapzen.whosonfirst.log.log(g,m);var h=mapzen.whosonfirst.php.htmlspecialchars(g);var f=mapzen.whosonfirst.php.htmlspecialchars(m);var k=document.createTextNode(h);var e=new Date();var j=e.toISOString();var l=document.createElement("li");l.setAttribute("id",j);l.setAttribute("ts",j);l.setAttribute("class",f);l.appendChild(k);var i=a._list();i.appendChild(l);a.schedule();return j},schedule:function(){if(b){}var e=a;b=setTimeout(function(){e.prune()},d)},prune:function(){var e=new Date();var l=a._list();var g=l.children;var k=g.length;for(var j=0;j<k;j++){var o=g[j];if(!o){continue}var m=o.getAttribute("ts");var p=o.getAttribute("cls");if(p=="persist"){continue}var f=new Date(m);var n=e-f;var h=c;if(p=="alert"){h=h*2}if(n>h){l.removeChild(o)}}var g=l.children;var k=g.length;if(k){a.schedule()}},remove:function(g){var e=document.getElementById(g);if(e){var f=a._list();f.removeChild(e)}},_list:function(){var f=document.getElementById("whereami-feedback-list");if(!f){var f=document.createElement("ul");f.setAttribute("id","whereami-feedback-list");var e=document.getElementById("whereami-feedback");e.appendChild(f)}return f},log:function(f,e){if(mapzen.whosonfirst.log){mapzen.whosonfirst.log.log(f,e)}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.geojson=(function(){var a={derive_bbox:function(b){if(b.bbox){return b.bbox}if(b.type=="FeatureCollection"){var d=b.features;var j=d.length;var k=undefined;var c=undefined;var m=undefined;var e=undefined;for(var h=0;h<j;h++){var o=a.derive_bbox(d[h]);var n,f,p,g=o;if((!k)||(n<k)){k=n}if((!c)||(f<c)){c=f}if((!m)||(p>m)){m=p}if((!e)||(g>e)){e=g}}return[k,c,m,e]}else{if(b.type=="Feature"){var l=b.geometry}else{}}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.leaflet=(function(){var a={draw_point:function(f,b,e,d){var c=L.geoJson(b,{style:e,pointToLayer:d});c.addTo(f);return c},draw_poly:function(i,c,g){var d=L.geoJson(c,{style:g});try{var f=c.properties;var b=f["lflt:label_text"];if(b){d.bindLabel(b,{noHide:true})}}catch(h){mapzen.whosonfirst.log.error("failed to bind label because "+h)}d.addTo(i);return d},draw_bbox:function(d,b,e){var k=mapzen.whosonfirst.geojson.derive_bbox(b);if(!k){mapzen.whosonfirst.log.error("no bounding box to draw");return false}var k=b.bbox;var h=k[1];var c=k[0];var j=k[3];var f=k[2];var i={type:"Polygon",coordinates:[[[c,h],[c,j],[f,j],[f,h],[c,h]]]};var g={type:"Feature",geometry:i};return a.draw_poly(d,g,e)},fit_map:function(d,c,e){var i=mapzen.whosonfirst.geojson.derive_bbox(c);if(!i){mapzen.whosonfirst.log.error("no bounding box to fit");return false}if((i[1]==i[3])&&(i[2]==i[4])){d.setView([i[1],i[0]],14);return}var h=[i[1],i[0]];var f=[i[3],i[2]];var b=new L.LatLngBounds([h,f]);var g=d.getBounds();var j=true;if(!e){var j=false;if(b.getSouth()<=g.getSouth().toFixed(6)){j=true}else{if(b.getWest()<=g.getWest().toFixed(6)){j=true}else{if(b.getNorth()>=g.getNorth().toFixed(6)){j=true}else{if(b.getEast()>=g.getEast().toFixed(6)){j=true}else{}}}}}if(j){d.fitBounds(b)}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.leaflet=mapzen.whosonfirst.leaflet||{};mapzen.whosonfirst.leaflet.styles=(function(){var a={bbox:function(){return{color:"#000000",weight:0.5,opacity:1,fillColor:"#000000",fillOpacity:0.4}},label_centroid:function(){return{color:"#fff",weight:3,opacity:1,radius:10,fillColor:"#ff0099",fillOpacity:0.8}},math_centroid:function(){return{color:"#fff",weight:2,opacity:1,radius:6,fillColor:"#ff7800",fillOpacity:0.8}},geom_centroid:function(){return{color:"#fff",weight:3,opacity:1,radius:10,fillColor:"#32cd32",fillOpacity:0.8}},search_centroid:function(){return{color:"#000",weight:2,opacity:1,radius:6,fillColor:"#0BBDFF",fillOpacity:1}},breach_polygon:function(){return{color:"#ffff00",weight:1.5,dashArray:"5, 5",opacity:1,fillColor:"#002EA7",fillOpacity:0.1}},consensus_polygon:function(){return{color:"#ff0066",weight:2,opacity:1,fillColor:"#ff69b4",fillOpacity:0.6}},pip_polygon:function(){return{color:"#ff0066",weight:2,opacity:1,fillColor:"#00308F",fillOpacity:0.5}},parent_polygon:function(){return{color:"#000",weight:1,opacity:1,fillColor:"#00308F",fillOpacity:0.5}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.leaflet=mapzen.whosonfirst.leaflet||{};mapzen.whosonfirst.leaflet.handlers=(function(){var a={point:function(b){return function(f,h){var c=L.circleMarker(h,b);try{var g=f.properties;var d=g["lflt:label_text"];if(d){c.bindLabel(d,{noHide:false})}}catch(i){console.log("failed to bind label because "+i)}return c}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.leaflet=mapzen.whosonfirst.leaflet||{};mapzen.whosonfirst.leaflet.tangram=(function(){var b="/spelunker/static/tangram/refill.yaml";var c={};var a={map_with_bbox:function(i,d,e,f,g){if((d==f)&&(e==g)){return a.map_with_latlon(i,d,e,14)}var h=a.map(i);h.fitBounds([[d,e],[f,g]]);return h},map_with_latlon:function(h,f,g,d){var e=a.map(h);e.setView([f,g],d);return e},map:function(f){if(!c[f]){var e=L.map(f);e.scrollWheelZoom.disable();var d=a.tangram();d.addTo(e);c[f]=e}return c[f]},tangram:function(f){var f=a.scenefile();var g=a.attributions();var d=a.render_attributions(g);var e=Tangram.leafletLayer({scene:f,numWorkers:2,unloadInvisibleTiles:false,updateWhenIdle:false,attribution:d});return e},scenefile:function(d){if(d){b=d}return b},attributions:function(){var d={Tangram:"https://mapzen.com/tangram","© OSM contributors":"http://www.openstreetmap.org/","Who's On First":"http://whosonfirst.mapzen.com/",Mapzen:"https://mapzen.com/"};return d},render_attributions:function(g){var i=[];for(var f in g){var h=g[f];var d=mapzen.whosonfirst.php.htmlspecialchars(f);if(!h){i.push(d);continue}var e='<a href="'+h+'" target="_blank">'+d+"</a>";i.push(e)}return i.join(" | ")}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.net=(function(){var b={};var a={encode_query:function(e){enc=new Array();for(var d in e){var c=e[d];c=encodeURIComponent(c);enc.push(d+"="+c)}return enc.join("&")},fetch:function(c,h,f){mapzen.whosonfirst.log.debug("fetch "+c);if(b[c]){mapzen.whosonfirst.log.debug("return "+c+" from cache");if(h){h(b[c])}return}var d=new XMLHttpRequest();d.onload=function(){try{var i=JSON.parse(this.responseText)}catch(j){mapzen.whosonfirst.log.error("failed to parse "+c+", because "+j);if(f){f()}return false}b[c]=i;if(h){h(i)}};try{d.open("get",c,true);d.send()}catch(g){mapzen.whosonfirst.log.error("failed to fetch "+c+", because ");mapzen.whosonfirst.log.debug(g);if(f){f()}}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.pelias=(function(){var c="https://search.mapzen.com/v1/search";var b="";var a={search:function(h,i,e){var d=mapzen.whosonfirst.pelias.apikey();var g={text:h,api_key:d};g=mapzen.whosonfirst.net.encode_query(g);var f=mapzen.whosonfirst.pelias.endpoint()+"?"+g;mapzen.whosonfirst.log.info("geocode "+h);mapzen.whosonfirst.net.fetch(f,i,e)},endpoint:function(d){if(d){c=d}return c},apikey:function(d){if(d){b=d}return b}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.iplookup=(function(){var c="http://localhost:8668";var b="";var a={lookup:function(g,h,d){var f={};if(g){f.ip=g}f=mapzen.whosonfirst.net.encode_query(f);var e=mapzen.whosonfirst.iplookup.endpoint()+"?"+f;mapzen.whosonfirst.log.info("lookup IP "+q);mapzen.whosonfirst.net.fetch(e,h,d)},endpoint:function(d){if(d){c=d}return c},apikey:function(d){if(d){b=d}return b}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.php=(function(){var a={htmlspecialchars:function(d,j,h,c){var f=0,e=0,g=false;if(typeof j==="undefined"||j===null){j=2}d=d.toString();if(c!==false){d=d.replace(/&/g,"&amp;")}d=d.replace(/</g,"&lt;").replace(/>/g,"&gt;");var b={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(j===0){g=true}if(typeof j!=="number"){j=[].concat(j);for(e=0;e<j.length;e++){if(b[j[e]]===0){g=true}else{if(b[j[e]]){f=f|b[j[e]]}}}j=f}if(j&b.ENT_HTML_QUOTE_SINGLE){d=d.replace(/'/g,"&#039;")}if(!g){d=d.replace(/"/g,"&quot;")}return d}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.pip=(function(){var b="";var a={get_by_latlon:function(f,g,h,c){var e={latitude:f,longitude:g};e=mapzen.whosonfirst.net.encode_query(e);mapzen.whosonfirst.log.info("pip "+e);var d=a.endpoint()+"?"+e;mapzen.whosonfirst.net.fetch(d,h,c)},endpoint:function(c){if(c){b=c}return b}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.iamhere=(function(){var b="/tangram/refill.yaml";var d;var c={};var a={init:function(){var l=mapzen.whosonfirst.iamhere.scenefile();mapzen.whosonfirst.leaflet.tangram.scenefile(l);var i=37.70120736474139;var e=-122.68707275390624;var j=37.80924146650164;var f=-122.21912384033203;d=mapzen.whosonfirst.leaflet.tangram.map_with_bbox("map",i,e,j,f);L.hash(d);d.on("load",function(n){a.update_location()});d.on("zoomend",function(n){a.update_location()});d.on("move",function(n){a.update_location()});d.on("dragend",function(n){a.reverse_geocode()});if(mapzen.whosonfirst.pelias.endpoint()){if(mapzen.whosonfirst.pelias.apikey()){var h=document.getElementById("find");h.onclick=a.search;var m=document.getElementById("search");m.style="display:inline;"}else{mapzen.whosonfirst.feedback.warning("Search is disabled because no API key has been defined")}}else{mapzen.whosonfirst.feedback.warning("Search is disabled because no API endpoint has been defined")}if(mapzen.whosonfirst.pip.endpoint()){var k=document.getElementById("findme");k.style="display:inline !important;";k.onclick=a.geolocate}else{mapzen.whosonfirst.feedback.warning("Reverse geocoding is disabled because no API endpoint has been defined")}if(mapzen.whosonfirst.iplookup.endpoint()){var g=undefined;mapzen.whosonfirst.iamhere.goto_ip(g)}window.onresize=a.draw_crosshairs;window.ononline=a.on_online;window.onoffline=a.on_offline;if(navigator.onLine){a.on_online()}else{a.on_offline()}a.draw_crosshairs();a.update_location();a.reverse_geocode()},goto_ip:function(i){var f=function(j){wofid=j.wofid;var k=mapzen.whosonfirst.data.id2abspath(wofid);mapzen.whosonfirst.net.fetch(k,e,g)};var h=function(j){mapzen.whosonfirst.log.error("failed to lookup IP address")};var e=function(k){var m=mapzen.whosonfirst.geojson.derive_bbox(k);var j=[m[1],m[0]];var l=[m[3],m[2]];d.fitBounds([j,l])};var g=function(j){mapzen.whosonfirst.log.error("failed to fetch record for IP address")};mapzen.whosonfirst.iplookup.lookup(i,f,h)},on_online:function(){mapzen.whosonfirst.feedback.info("you are in online mode");var h=document.getElementById("q");h.setAttribute("placeholder","search for a place");h.removeAttribute("disabled");h.value="";var g=document.getElementById("find");g.removeAttribute("disabled");var e=document.getElementById("findme");e.style="display:inline;color:#2E78A8"},on_offline:function(){mapzen.whosonfirst.feedback.info("you are in offline mode");var g=mapzen.whosonfirst.pelias.endpoint();if(!a.is_localhost(g)){var i=document.getElementById("q");i.setAttribute("placeholder","search is disabled");i.setAttribute("disabled","disabled");i.value="";var h=document.getElementById("find");h.style="display:none;";h.setAttribute("disabled","disabled")}var e=document.getElementById("findme");e.style="display:inline;color:#bbb"},is_localhost:function(e){var f=e.split(":");if(f[1]=="//localhost"){return true}return false},geolocate:function(){if(!navigator.onLine){mapzen.whosonfirst.feedback.alert("Unable to lookup your location because you are offline");return false}var h=mapzen.whosonfirst.feedback.persist("Looking up your location");var g=function(){mapzen.whosonfirst.feedback.remove(h)};var f=function(k){g();var i=k.coords.latitude;var j=k.coords.longitude;a.jump_to(i,j,16)};var e=function(i){g()};navigator.geolocation.getCurrentPosition(f,e)},search:function(){var g=mapzen.whosonfirst.pelias.endpoint();if((!navigator.onLine)&&(!a.is_localhost(g))){mapzen.whosonfirst.feedback.alert("Unable to perform your search query because you seem to be offline");return false}var f=document.getElementById("q");f=f.value;if(f==""){mapzen.whosonfirst.feedback.alert("You forgot to say what you're searching for...");return false}a.geocode(f);return false},geocode:function(i){var e=mapzen.whosonfirst.php.htmlspecialchars(i);var g=mapzen.whosonfirst.feedback.persist("searching for "+e);var f=function(){mapzen.whosonfirst.feedback.remove(g)};var j=function(k){a.on_geocode(k)};var h=function(){};mapzen.whosonfirst.pelias.search(i,j,h)},on_geocode:function(e){var g=e.features;var k=g[0];var f=k.geometry;var h=f.coordinates;var i=h[1];var j=h[0];a.jump_to(i,j,12)},reverse_geocode:function(j,k){var i=mapzen.whosonfirst.pip.endpoint();if((!navigator.onLine)&&(!a.is_localhost(i))){mapzen.whosonfirst.feedback.alert("Reverse geocoding is disabled because you are offline");return false}var h=d.getCenter();var j=h.lat;var k=h.lng;var l=function(e){a.on_reverse_geocode(e)};var g=function(e){var m=document.getElementById("whereami-reversegeo");m.style="display:inline !important;";m.innerHTML="the land of INVISIBLE ERROR CAT because the reverse geocoding failed"};mapzen.whosonfirst.pip.get_by_latlon(j,k,l,g);var f=document.getElementById("whereami-reversegeo");f.style="display:none !important;";f.innerHTML=""},on_reverse_geocode:function(g){var k=g.length;var l=c.length;mapzen.whosonfirst.log.info("reverse geocode possible results: "+k);var s={};for(var j=0;j<k;j++){var o=g[j];var v=o.Id;if(c[v]){s[v]=1}}for(var v in c){if(s[v]){continue}mapzen.whosonfirst.log.debug("remove layer for WOF ID "+v);var m=c[v];delete (c[v]);d.removeLayer(m)}var u=document.getElementById("whereami-reversegeo");u.style="display:inline !important;";if(!k){u.innerHTML="a place we don't know about";return}var n=g.length;var h=[];for(var j=0;j<n;j++){var o=g[j];var v=o.Id;var e=o.Name;var f=encodeURIComponent(v);var p=mapzen.whosonfirst.php.htmlspecialchars(e);var r='<a href="https://whosonfirst.mapzen.com/spelunker/id/'+f+'/">';r+=p;r+="</a>";h.push(r);if(c[v]){continue}var t=function(x){var A=x.properties;var z=A["wof:id"];var i=A["wof:name"];x.properties["lflt:label_text"]=i;mapzen.whosonfirst.log.debug("draw layer for WOF ID "+z);var y=mapzen.whosonfirst.leaflet.styles.pip_polygon();var w=mapzen.whosonfirst.leaflet.draw_poly(d,x,y);c[z]=w};mapzen.whosonfirst.log.debug("fetch layer for WOF ID "+v);mapzen.whosonfirst.enmapify.render_id(d,v,t)}h=h.join(" or ");u.innerHTML=h},jump_to:function(f,g,e){d.setView([f,g],e);a.update_location();a.reverse_geocode()},update_location:function(){var h=d.getCenter();var g=h.lat;var i=h.lng;g=g.toFixed(6);i=i.toFixed(6);var j=g+","+i;j=mapzen.whosonfirst.php.htmlspecialchars(j);var e=document.getElementById("whereami-latlon");e.innerHTML=j;var f=d.getZoom();f=mapzen.whosonfirst.php.htmlspecialchars(f);var e=document.getElementById("whereami-zoom");e.innerHTML=f},draw_crosshairs:function(){var k=document.getElementById("map");var g=k.getBoundingClientRect();var n=g.height;var h=g.width;var i=(n/2)-8;var j=(h/2);var e='"data:image/gif;base64,R0lGODlhEwATAKEBAAAAAP///////////yH5BAEKAAIALAAAAAATABMAAAIwlI+pGhALRXuRuWopPnOj7hngEpRm6ZymAbTuC7eiitJlNHr5tmN99cNdQpIhsVIAADs="';var f=[];f.push("position:absolute");f.push("top:"+i+"px");f.push("height:19px");f.push("width:19px");f.push("left:"+j+"px");f.push("margin-left:-8px;");f.push("display:block");f.push("background-position: center center");f.push("background-repeat: no-repeat");f.push("background: url("+e+")");f.push("z-index:200");f=f.join(";");var l=document.getElementById("crosshairs");l.style=f},scenefile:function(e){if(e){b=e}return b}};return a})();